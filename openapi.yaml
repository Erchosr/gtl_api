openapi: 3.0.0
info:
  title: Email API
  description: >
    Cette API permet de r√©cup√©rer les d√©tails des emails et les emails non lus
    d'une boite mail donn√©es, Le mail demand√© va ensuite √™tre affich√© dans une
    page sous forme de JSON en utilisant l'url choisi.
  version: 1.0.0
  contact:
    name: Support API
    url: http://localhost/stage_gtl/project_api/readme
    email: support@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
  - url: http://localhost/stage_gtl/project_api
    description: Serveur de d√©veloppement local
paths:
  /view_email.php:
    get:
      summary: R√©cup√©rer les d√©tails d'un email sp√©cifique ou tous les emails non lus
      description: >
        Cet endpoint permet de r√©cup√©rer les d√©tails d'un email sp√©cifique en
        utilisant le param√®tre `email_number`. Si le param√®tre `email_number`
        n'est pas fourni, l'endpoint retourne tous les emails non lus.
      parameters:
        - name: email_number
          in: query
          description: Num√©ro de l'email √† r√©cup√©rer
          required: false
          schema:
            type: integer
          example: 31
      responses:
        '200':
          description: D√©tails de l'email ou liste des emails non lus
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/EmailDetails'
                  - type: array
                    items:
                      $ref: '#/components/schemas/EmailDetails'
              examples:
                singleEmail:
                  summary: Exemple de r√©ponse pour un email sp√©cifique
                  value:
                    email_id: 31
                    subject: Mail avec pi√®ces jointes
                    from: Dany DA GRA√áA <dagracadany@gmx.fr>
                    date: Fri, 4 Oct 2024 16:55:56 +0200
                    read: 'no'
                    plain_content: |-
                      C'est un mail avec du texte et des pi√®ces jointes.
                      --
                      *Dany DA GRA√áA*
                      06 05 03 09 34
                      dagracadany@gmx.fr
                    html_content: >-
                      <p>C'est un mail avec du texte et des pi√®ces
                      jointes.<br></p><div class="moz-signature">-- <br><b>Dany
                      DA GRA√áA</b><br>06 05 03 09 34<br><a
                      href="dagracadany@gmx.fr"
                      class="moz-txt-link-freetext">dagracadany@gmx.fr</a></div>
                    attachments:
                      - filename: image_1.jpg
                        path: >-
                          http://localhost/stage_gtl/project_api/attachments/20241004_165556_5566_image_1.jpg
                    recipients:
                      - demo@gtl-digital.fr
                      - autre@exemple.com
                unreadEmails:
                  summary: Exemple de r√©ponse pour les emails non lus
                  value:
                    - email_id: 31
                      subject: Mail avec pi√®ces jointes
                      from: Dany DA GRA√áA <dagracadany@gmx.fr>
                      date: Fri, 4 Oct 2024 16:55:56 +0200
                      read: 'no'
                      plain_content: |-
                        C'est un mail avec du texte et des pi√®ces jointes.
                        --
                        *Dany DA GRA√áA*
                        06 05 03 09 34
                        dagracadany@gmx.fr
                      html_content: >-
                        <p>C'est un mail avec du texte et des pi√®ces
                        jointes.<br></p><div class="moz-signature">--
                        <br><b>Dany DA GRA√áA</b><br>06 05 03 09 34<br><a
                        href="dagracadany@gmx.fr"
                        class="moz-txt-link-freetext">dagracadany@gmx.fr</a></div>
                      attachments:
                        - filename: image_1.jpg
                          path: >-
                            http://localhost/stage_gtl/project_api/attachments/20241004_165556_5566_image_1.jpg
                      recipients:
                        - demo@gtl-digital.fr
                        - autre@exemple.com
        '404':
          description: Email non trouv√©
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Email avec l'ID 31 non trouv√©.
  /index.php:
    get:
      summary: >-
        Lister tous les emails avec une ic√¥ne pour les emails avec des pi√®ces
        jointes
      description: >
        Cet endpoint permet de lister tous les emails de la bo√Æte email fournie
        de fa√ßon lisible.
      responses:
        '200':
          description: Liste des emails
          content:
            text/html:
              schema:
                type: string
                example: |
                  <!DOCTYPE html>
                  <html lang="fr">
                  <head>
                      <meta charset="UTF-8">
                      <title>Liste des Emails</title>
                  </head>
                  <body>
                      <h1>Liste des Emails</h1>
                      <table border="1">
                          <tr>
                              <th>Sujet</th>
                              <th>Exp√©diteur</th>
                              <th>Date</th>
                              <th>Statut</th>
                              <th>Pi√®ces jointes</th>
                              <th>Destinataires</th>
                              <th>Actions</th>
                          </tr>
                          <tr>
                              <td>Mail avec pi√®ces jointes</td>
                              <td>Dany DA GRA√áA &lt;dagracadany@gmx.fr&gt;</td>
                              <td>Fri, 4 Oct 2024 16:55:56 +0200</td>
                              <td>Non lu</td>
                              <td>üìé</td>
                              <td>demo@gtl-digital.fr, autre@exemple.com</td>
                              <td>
                                  <a href="view_email.php?email_number=31">Voir</a>
                                  <a href="get_file.php?email_number=31">T√©l√©charger les pi√®ces jointes</a>
                              </td>
                          </tr>
                      </table>
                  </body>
                  </html>
  /get_file.php:
    get:
      summary: Installer les pi√®ces jointes d'un email sp√©cifique
      description: >
        Cet endpoint permet d'installer les pi√®ces jointes d'un email sp√©cifique
        en utilisant le param√®tre `email_number`.
      parameters:
        - name: email_number
          in: query
          description: Num√©ro de l'email √† r√©cup√©rer
          required: true
          schema:
            type: integer
          example: 31
      responses:
        '200':
          description: Les pi√®ces jointes de l'email ont √©t√© install√©es avec succ√®s
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttachmentInstallationResponse'
              example:
                message: >-
                  The attachments of the email [31] have been installed
                  successfully.
                attachments:
                  - filename: image_1.jpg
                    path: >-
                      http://stage_gtl/project_api/attachments/20241004_165556_5566_image_1.jpg
        '404':
          description: Email non trouv√©
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Email avec l'ID 31 non trouv√©.
components:
  schemas:
    EmailDetails:
      type: object
      properties:
        email_id:
          type: integer
          description: Num√©ro de l'email
          example: 31
        subject:
          type: string
          description: Sujet de l'email
          example: Mail avec pi√®ces jointes
        from:
          type: string
          description: Exp√©diteur de l'email
          example: Dany DA GRA√áA <dagracadany@gmx.fr>
        date:
          type: string
          description: Date de l'email
          example: Fri, 4 Oct 2024 16:55:56 +0200
        read:
          type: string
          description: Indique si l'email a √©t√© lu
          example: 'no'
        plain_content:
          type: string
          description: Contenu brut de l'email
          example: |-
            C'est un mail avec du texte et des pi√®ces jointes.
            --
            *Dany DA GRA√áA*
            06 05 03 09 34
            dagracadany@gmx.fr
        html_content:
          type: string
          description: Contenu HTML de l'email
          example: >-
            <p>C'est un mail avec du texte et des pi√®ces jointes.<br></p><div
            class="moz-signature">-- <br><b>Dany DA GRA√áA</b><br>06 05 03 09
            34<br><a href="dagracadany@gmx.fr"
            class="moz-txt-link-freetext">dagracadany@gmx.fr</a></div>
        attachments:
          type: array
          items:
            type: object
            properties:
              filename:
                type: string
                description: Nom du fichier joint
                example: image_1.jpg
              path:
                type: string
                description: Chemin complet du fichier joint
                example: >-
                  http://stage_gtl/project_api/attachments/20241004_165556_5566_image_1.jpg
        recipients:
          type: array
          items:
            type: string
          description: Liste des destinataires de l'email
          example:
            - demo@gtl-digital.fr
            - autre@exemple.com
    AttachmentInstallationResponse:
      type: object
      properties:
        message:
          type: string
          description: Message de succ√®s
          example: The attachments of the email [31] have been installed successfully.
        attachments:
          type: array
          items:
            type: object
            properties:
              filename:
                type: string
                description: Nom du fichier joint
                example: image_1.jpg
              path:
                type: string
                description: Chemin complet du fichier joint
                example: >-
                  http://stage_gtl/project_api/attachments/20241004_165556_5566_image_1.jpg
    Error:
      type: object
      properties:
        error:
          type: string
          description: Message d'erreur
          example: Email avec l'ID 31 non trouv√©.
